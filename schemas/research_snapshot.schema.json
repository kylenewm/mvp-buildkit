{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Research Snapshot",
    "description": "Phase -1 research snapshot. Bounds uncertainty before planning. Not a knowledge base.",
    "type": "object",
    "required": [
      "schema_version",
      "build_id",
      "state_version",
      "retrieved_at",
      "research_questions",
      "findings",
      "unknowns",
      "decision_recommendations",
      "sufficiency",
      "size_caps"
    ],
    "properties": {
      "schema_version": {
        "type": "string",
        "pattern": "^[0-9]+\\.[0-9]+$"
      },
      "build_id": {
        "type": "string",
        "pattern": "^B[0-9]+$"
      },
      "state_version": {
        "type": "integer",
        "minimum": 1
      },
  
      "retrieved_at": {
        "type": ["string", "null"],
        "description": "ISO 8601 timestamp when research was actually conducted",
        "format": "date-time"
      },
  
      "research_questions": {
        "type": "array",
        "minItems": 1,
        "maxItems": 15,
        "items": {
          "type": "object",
          "required": ["id", "question", "recency_days"],
          "properties": {
            "id": {
              "type": "string",
              "pattern": "^RQ[0-9]+$"
            },
            "question": {
              "type": "string",
              "minLength": 1,
              "maxLength": 240
            },
            "recency_days": {
              "type": "integer",
              "minimum": 1,
              "maximum": 3650
            },
            "tags": {
              "type": "array",
              "maxItems": 5,
              "items": {
                "type": "string",
                "minLength": 2,
                "maxLength": 40
              }
            }
          },
          "additionalProperties": false
        }
      },
  
      "answers": {
        "type": "array",
        "description": "Per-question answer summaries from Tavily AI synthesis",
        "maxItems": 20,
        "items": {
          "type": "object",
          "required": ["rq_id", "question", "answer_summary"],
          "properties": {
            "rq_id": {
              "type": "string",
              "pattern": "^RQ[0-9]+$"
            },
            "question": {
              "type": "string",
              "maxLength": 300
            },
            "answer_summary": {
              "type": "string",
              "description": "Tavily AI-generated synthesis (non-authoritative)",
              "maxLength": 2000
            }
          },
          "additionalProperties": false
        }
      },

      "findings": {
        "type": "array",
        "description": "Evidence snippets from search results",
        "maxItems": 75,
        "items": {
          "type": "object",
          "required": [
            "id",
            "claim",
            "evidence_snippet",
            "page_title",
            "source_url",
            "retrieved_at"
          ],
          "properties": {
            "id": {
              "type": "string",
              "pattern": "^F[0-9]+$"
            },
            "claim": {
              "type": "string",
              "description": "Scannable label derived from snippet (max 160 chars)",
              "minLength": 1,
              "maxLength": 200
            },
            "evidence_snippet": {
              "type": "string",
              "description": "Tavily content snippet (source of truth for review)",
              "minLength": 1,
              "maxLength": 1600
            },
            "page_title": {
              "type": "string",
              "description": "Title of the source page",
              "maxLength": 300
            },
            "source_url": {
              "type": "string",
              "minLength": 5
            },
            "retrieved_at": {
              "type": "string",
              "format": "date-time"
            },
            "rq_id": {
              "type": "string",
              "description": "Links finding back to research question",
              "pattern": "^RQ[0-9]+$"
            },
            "tier": {
              "type": "string",
              "enum": ["tier1_official", "tier2_reputable", "tier3_unverified"]
            },
            "confidence": {
              "type": "string",
              "enum": ["low", "med", "high"]
            },
            "triage_bucket": {
              "type": "string",
              "enum": ["high", "normal", "low", "junk"],
              "description": "LLM triage bucket for sorting (high first, junk last)"
            },
            "triage_reason": {
              "type": "string",
              "maxLength": 150,
              "description": "LLM triage reason (single sentence)"
            }
          },
          "additionalProperties": false
        }
      },
  
      "unknowns": {
        "type": "array",
        "maxItems": 20,
        "items": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200
        }
      },
  
      "decision_recommendations": {
        "type": "array",
        "maxItems": 20,
        "items": {
          "type": "object",
          "required": [
            "id",
            "recommendation",
            "rationale",
            "related_findings"
          ],
          "properties": {
            "id": {
              "type": "string",
              "pattern": "^DR[0-9]+$"
            },
            "recommendation": {
              "type": "string",
              "minLength": 1,
              "maxLength": 200
            },
            "rationale": {
              "type": "string",
              "minLength": 1,
              "maxLength": 500
            },
            "related_findings": {
              "type": "array",
              "minItems": 1,
              "maxItems": 10,
              "items": {
                "type": "string",
                "pattern": "^F[0-9]+$"
              }
            }
          },
          "additionalProperties": false
        }
      },
  
      "sufficiency": {
        "type": "object",
        "required": ["status", "rationale"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["unknown", "sufficient", "insufficient"]
          },
          "rationale": {
            "type": "string",
            "minLength": 1,
            "maxLength": 600
          }
        },
        "additionalProperties": false
      },
  
      "size_caps": {
        "type": "object",
        "required": ["max_lines", "max_words"],
        "properties": {
          "max_lines": { "type": "integer", "minimum": 1 },
          "max_words": { "type": "integer", "minimum": 1 }
        },
        "additionalProperties": false
      }
    },
    "additionalProperties": false
  }
  